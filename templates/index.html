<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicta AI - Geli≈ümi≈ü Futbol Tahmin Sistemi</title>
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #303f9f 50%, #3949ab 100%);
            color: #fff; line-height: 1.5; min-height: 100vh;
        }
        .header {background: linear-gradient(135deg, #0d1b69 0%, #1a237e 100%);
            border-bottom: 3px solid #3f51b5; text-align: center; padding: 30px 20px;}
        .header h1 {font-size: 3rem; font-weight: 700;
            background: linear-gradient(45deg, #ffd700, #ffeb3b);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .tagline {font-size: 0.95rem; color: #b3c7f7;}
        .version-badge {display: inline-block; margin-top: 10px; padding: 5px 15px;
            background: rgba(76, 175, 80, 0.3); border-radius: 20px; font-size: 0.85rem;
            color: #4caf50; border: 1px solid #4caf50;}
        .disclaimer {background: rgba(255, 152, 0, 0.2); border: 2px solid #ff9800;
            border-radius: 8px; padding: 15px; margin: 20px auto; max-width: 1400px; text-align: center;}
        .disclaimer-title {font-weight: 700; color: #ffb74d; margin-bottom: 8px;}
        .disclaimer-text {font-size: 0.9rem; color: #ffe0b2;}
        .container {max-width: 1400px; margin: 20px auto; padding: 0 20px;
            display: grid; grid-template-columns: 280px 1fr; gap: 20px;}
        .sidebar {background: linear-gradient(135deg, rgba(26,35,126,0.8), rgba(30,39,130,0.9));
            border-radius: 12px; padding: 20px; position: sticky; top: 20px;}
        .sidebar-title {font-size: 1.2rem; font-weight: 700; color: #ffd700; margin-bottom: 15px;}
        .league-list {max-height: calc(100vh - 200px); overflow-y: auto;}
        .league-item {padding: 12px 15px; margin-bottom: 8px; background: rgba(255,255,255,0.05);
            border-radius: 8px; cursor: pointer; transition: all 0.3s ease; display: flex; justify-content: space-between;}
        .league-item:hover {background: rgba(255,215,0,0.1); border-left: 3px solid #ffd700;}
        .league-item.active {background: rgba(255,215,0,0.2); border-left: 3px solid #ffd700; font-weight: 600;}
        .league-name {font-size: 0.9rem;}
        .league-count {background: rgba(255,215,0,0.3); padding: 2px 8px; border-radius: 10px; font-size: 0.75rem;}
        .main-area {min-height: 500px;}
        .stats-container {display: grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap: 15px; margin-bottom: 25px;}
        .stat-box {background: rgba(255,255,255,0.05); border-radius: 8px; padding: 20px; text-align: center;}
        .stat-value {font-size: 2rem; font-weight: 700; color: #ffd700;}
        .stat-label {font-size: 0.9rem; color: #b3c7f7;}
        .controls {background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px; margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;}
        .control-label {font-weight: 600; color: #ffd700;}
        .filter-btn, .sort-btn {padding: 10px 20px; background: rgba(63,81,181,0.6); border: 2px solid rgba(255,255,255,0.2); border-radius: 6px; cursor: pointer;}
        .filter-btn.active, .sort-btn.active {background: linear-gradient(135deg, #ffd700, #ff8f00); border-color: #ffd700; color: #1a237e;}
        .main-content {background: rgba(26,35,126,0.8); border-radius: 12px; border: 1px solid rgba(63,81,181,0.2); overflow: hidden;}
        .loading {text-align: center; padding: 60px 20px; font-size: 1.2rem; color: #ffd700;}
        .match-list {padding: 20px;}
        .match-card {background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 15px;}
        .match-header {display: flex; justify-content: space-between; flex-wrap: wrap;}
        .match-teams {font-size: 1.3rem; font-weight: 700;}
        .match-league {font-size: 0.9rem; color: #b3c7f7;}
        .prediction-badge {padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600;}
        .prediction-badge.very-high {background: #4caf50;}
        .prediction-badge.high {background: #2196f3;}
        .prediction-badge.medium {background: #ff9800;}
        .prediction-badge.low {background: #f44336;}
        .odds-container {display: flex; gap: 10px; margin-top: 15px;}
        .odds-btn {flex: 1; padding: 12px; background: rgba(63,81,181,0.6); border-radius: 8px; text-align: center;}
        .odds-btn.predicted {border: 2px solid #ffd700;}
        .odds-label {font-size: 0.85rem; color: #b3c7f7;}
        .odds-value {font-size: 1.1rem; font-weight: 700;}
    </style>
</head>
<body>
<header class="header">
    <h1>PREDICTA AI</h1>
    <div class="tagline">Geli≈ümi≈ü Hybrid Model ile Profesyonel Futbol Analizi</div>
    <div class="version-badge">v6.0 - League Selector</div>
</header>

<div class="disclaimer">
    <div class="disclaimer-title">√ñNEMLƒ∞ UYARI</div>
    <div class="disclaimer-text">
        Bu platform eƒüitim ve analiz ama√ßlƒ±dƒ±r. Tahminler matematiksel modellere dayanƒ±r ancak %100 doƒüruluk garantisi yoktur.<br>
        Kumar baƒüƒ±mlƒ±lƒ±ƒüƒ± ciddi bir sorundur. Ger√ßek bahis kararlarƒ±nƒ±zƒ± bu tahminlere g√∂re vermeyiniz.<br>
        18 ya≈üƒ±ndan k√º√ß√ºklerin bahis oynamasƒ± yasaktƒ±r.
    </div>
</div>

<div class="container">
    <!-- SOL MENU -->
    <aside class="sidebar">
        <div class="sidebar-title">üìã Ligler</div>
        <div class="league-list" id="league-list">
            <div class="loading">Ligler y√ºkleniyor...</div>
        </div>
    </aside>

    <!-- ANA ƒ∞√áERƒ∞K -->
    <main class="main-area">
        <div class="stats-container">
            <div class="stat-box">
                <div class="stat-value" id="total-matches">0</div>
                <div class="stat-label">Toplam Ma√ß</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="high-confidence">0</div>
                <div class="stat-label">Y√ºksek G√ºven (>65%)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="medium-confidence">0</div>
                <div class="stat-label">Orta G√ºven (50-65%)</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="selected-league-name">T√ºm Ligler</div>
                <div class="stat-label">Se√ßili Lig</div>
            </div>
        </div>

        <div class="controls">
            <div>
                <span class="control-label">Filtrele:</span>
                <button class="filter-btn active" onclick="filterMatches('all',event)">T√ºm√º</button>
                <button class="filter-btn" onclick="filterMatches('high-confidence',event)">Y√ºksek G√ºven</button>
                <button class="filter-btn" onclick="filterMatches('medium',event)">Orta G√ºven</button>
            </div>
            <div style="margin-left:auto;">
                <span class="control-label">Sƒ±rala:</span>
                <button class="sort-btn active" onclick="sortMatches('confidence',event)">G√ºvene G√∂re</button>
                <button class="sort-btn" onclick="sortMatches('time',event)">Zamana G√∂re</button>
            </div>
        </div>

        <div class="main-content">
            <div style="text-align:center;padding:20px;">
                <button class="refresh-btn" onclick="loadMatches()">üîÑ Verileri Yenile</button>
            </div>
            <div id="content-area" class="loading">AI tahmin motoru ba≈ülatƒ±lƒ±yor...</div>
        </div>
    </main>
</div>

<script>
    let allMatches = [];
    let currentFilter = 'all';
    let currentSort = 'confidence';
    let selectedLeague = 'all';
    const API_BASE_URL = 'https://predicta-production.up.railway.app';

    async function loadMatches() {
        try {
            showLoading();
            const response = await fetch(`${API_BASE_URL}/api/predictions/upcoming?limit=500`);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();
            if (data.success && data.matches) {
                allMatches = data.matches;
                buildLeagueList();
                updateStats();
                applyFiltersAndSort();
            }
        } catch (err) {
            showError(err.message);
        }
    }

    function buildLeagueList() {
        const leagueCounts = {};
        allMatches.forEach(m=>{leagueCounts[m.league] = (leagueCounts[m.league]||0)+1;});
        const sorted = Object.entries(leagueCounts).sort((a,b)=>b[1]-a[1]);
        let html = `<div class="league-item ${selectedLeague==='all'?'active':''}" onclick="selectLeague('all',event)">
                        üåç T√ºm Ligler <span class="league-count">${allMatches.length}</span></div>`;
        sorted.forEach(([l,c])=>{
            html += `<div class="league-item ${selectedLeague===l?'active':''}" onclick="selectLeague('${l}',event)">
                        ${getLeagueEmoji(l)} ${l}<span class="league-count">${c}</span></div>`;
        });
        document.getElementById('league-list').innerHTML = html;
    }

    function getLeagueEmoji(l) {
        l=l.toLowerCase();
        if(l.includes('s√ºper lig')||l.includes('turkey')) return 'üáπüá∑';
        if(l.includes('premier')) return 'üè¥';
        if(l.includes('la liga')) return 'üá™üá∏';
        if(l.includes('serie a')) return 'üáÆüáπ';
        if(l.includes('bundesliga')) return 'üá©üá™';
        if(l.includes('ligue')) return 'üá´üá∑';
        return '‚öΩ';
    }

    function selectLeague(l,event){
        selectedLeague=l;
        document.querySelectorAll('.league-item').forEach(x=>x.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById('selected-league-name').textContent = l==='all'?'T√ºm Ligler':l;
        applyFiltersAndSort();
    }

    function filterMatches(f,event){
        currentFilter=f;
        document.querySelectorAll('.filter-btn').forEach(x=>x.classList.remove('active'));
        event.currentTarget.classList.add('active');
        applyFiltersAndSort();
    }

    function sortMatches(s,event){
        currentSort=s;
        document.querySelectorAll('.sort-btn').forEach(x=>x.classList.remove('active'));
        event.currentTarget.classList.add('active');
        applyFiltersAndSort();
    }

    function normalizeConfidence(c){return c<=1?c*100:c;}
    function getConfidenceClass(c){if(c>=80) return 'very-high'; if(c>=65) return 'high'; if(c>=50) return 'medium'; return 'low';}

    function applyFiltersAndSort(){
        let filtered=[...allMatches];
        if(selectedLeague!=='all') filtered=filtered.filter(m=>m.league===selectedLeague);
        if(currentFilter==='high-confidence') filtered=filtered.filter(m=>normalizeConfidence(m.ai_prediction?.confidence||0)>=65);
        if(currentFilter==='medium') filtered=filtered.filter(m=>{let c=normalizeConfidence(m.ai_prediction?.confidence||0);return c>=50&&c<65;});
        if(currentSort==='confidence') filtered.sort((a,b)=>normalizeConfidence(b.ai_prediction?.confidence||0)-normalizeConfidence(a.ai_prediction?.confidence||0));
        if(currentSort==='time') filtered.sort((a,b)=>(`${a.date} ${a.time}`).localeCompare(`${b.date} ${b.time}`));
        updateStats(filtered); displayMatches(filtered);
    }

    function updateStats(f=allMatches){
        document.getElementById('total-matches').textContent=f.length;
        document.getElementById('high-confidence').textContent=f.filter(m=>normalizeConfidence(m.ai_prediction?.confidence||0)>=65).length;
        document.getElementById('medium-confidence').textContent=f.filter(m=>{let c=normalizeConfidence(m.ai_prediction?.confidence||0);return c>=50&&c<65;}).length;
    }

    function displayMatches(matches){
        const area=document.getElementById('content-area');
        if(matches.length===0){area.innerHTML=`<div class="loading">Bu lig/filtre i√ßin ma√ß bulunamadƒ±</div>`;return;}
        let html='<div class="match-list">';
        matches.forEach(m=>{
            const p=m.ai_prediction||{}, conf=normalizeConfidence(p.confidence||0),
                  res=p.predicted_result||'X', probs=p.probabilities||{1:0.33,X:0.33,2:0.33};
            html+=`<div class="match-card">
                     <div class="match-header">
                       <div><div class="match-teams">${m.home_team} vs ${m.away_team}</div>
                       <div class="match-league">${m.league} ‚Ä¢ ${m.date} ${m.time}</div></div>
                       <div class="prediction-badge ${getConfidenceClass(conf)}">Tahmin: ${res} (${conf.toFixed(1)}%)</div>
                     </div>
                     <div class="odds-container">
                       <div class="odds-btn ${res==='1'?'predicted':''}"><div class="odds-label">1</div><div class="odds-value">${(m.odds?.['1']||2.0).toFixed(2)}</div></div>
                       <div class="odds-btn ${res==='X'?'predicted':''}"><div class="odds-label">X</div><div class="odds-value">${(m.odds?.X||3.0).toFixed(2)}</div></div>
                       <div class="odds-btn ${res==='2'?'predicted':''}"><div class="odds-label">2</div><div class="odds-value">${(m.odds?.['2']||3.5).toFixed(2)}</div></div>
                     </div>
                   </div>`;
        });
        area.innerHTML=html+'</div>';
    }

    function showLoading(){document.getElementById('content-area').innerHTML='<div class="loading">Veriler y√ºkleniyor...</div>';}
    function showError(m){document.getElementById('content-area').innerHTML=`<div style="color:red">${m}</div>`;}
    window.addEventListener('load',()=>{loadMatches(); setInterval(loadMatches,300000);});
</script>
</body>
</html>
