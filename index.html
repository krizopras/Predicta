<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Predicta AI - Profesyonel Futbol Tahmin Sistemi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      color:#fff; min-height:100vh;
    }
    .header {text-align:center; padding:40px 20px; background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);}
    .header h1 {font-size:3rem; font-weight:700; background:linear-gradient(45deg,#ffd700,#ff9800);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
    .tagline {color:#cfd8dc; margin-top:8px;}
    .version-badge {margin-top:10px;display:inline-block;padding:6px 14px;border-radius:20px;background:rgba(255,215,0,0.15);color:#ffd700;font-size:0.85rem;}
    .container {max-width:1400px; margin:30px auto; padding:0 20px; display:grid; grid-template-columns:280px 1fr; gap:25px;}
    .sidebar {background:rgba(255,255,255,0.08);backdrop-filter:blur(12px);border-radius:16px; padding:20px;}
    .sidebar-title {font-size:1.2rem;font-weight:600;color:#ffd700;margin-bottom:15px;}
    .league-list {max-height:calc(100vh - 200px);overflow-y:auto;}
    .league-item {padding:12px 15px;margin-bottom:10px;border-radius:12px;display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.04);cursor:pointer;transition:all .3s ease;}
    .league-item:hover {background:rgba(255,215,0,0.15);transform:translateX(4px);}
    .league-item.active {background:linear-gradient(135deg,#ffd70033,#ff980033);border-left:4px solid #ffd700;}
    .league-name {font-size:0.95rem;}
    .league-count {background:rgba(255,215,0,0.25);padding:2px 8px;border-radius:10px;font-size:0.75rem;color:#ffd700;}
    .stats-container {display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:25px;}
    .stat-box {background:rgba(255,255,255,0.07);border-radius:14px;padding:20px;text-align:center;}
    .stat-value {font-size:2.2rem;font-weight:700;color:#ffd700;margin-bottom:8px;}
    .stat-label {color:#cfd8dc;font-size:0.9rem;}
    .controls {display:flex;flex-wrap:wrap;gap:12px;margin-bottom:20px;}
    .control-label {font-weight:600;color:#ffd700;}
    .filter-btn,.sort-btn {padding:10px 18px;border:none;border-radius:8px;background:rgba(255,255,255,0.08);color:#fff;font-weight:600;cursor:pointer;transition:all .3s;}
    .filter-btn:hover,.sort-btn:hover {background:rgba(255,215,0,0.2);}
    .filter-btn.active,.sort-btn.active {background:linear-gradient(135deg,#ffd700,#ff9800);color:#1a237e;}
    .main-content {background:rgba(255,255,255,0.05);border-radius:16px;backdrop-filter:blur(10px);padding:20px;}
    .loading {text-align:center;padding:40px;color:#ffd700;}

    .league-section {margin-bottom:35px;}
    .league-header {
      background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(255,152,0,0.2));
      padding:15px 20px;border-radius:12px;margin-bottom:15px;
      display:flex;justify-content:space-between;align-items:center;
      border-left:5px solid #ffd700;
    }
    .league-title {font-size:1.3rem;font-weight:700;color:#ffd700;}
    .league-match-count {background:rgba(255,255,255,0.2);padding:5px 12px;border-radius:20px;font-size:0.9rem;}
    
    .match-table-container {
      background:rgba(255,255,255,0.03);
      border-radius:12px;
      overflow:hidden;
    }
    table {width:100%;border-collapse:collapse;}
    thead {background:rgba(255,215,0,0.1);border-bottom:2px solid rgba(255,215,0,0.3);}
    th {padding:12px;text-align:center;color:#ffd700;font-size:0.9rem;font-weight:600;}
    th:nth-child(2) {text-align:left;}
    tbody tr {border-bottom:1px solid rgba(255,255,255,0.05);transition:background 0.2s;}
    tbody tr:hover {background:rgba(255,215,0,0.05);}
    td {padding:15px 12px;}
    
    .match-time {color:#b0bec5;font-size:0.85rem;text-align:center;line-height:1.4;}
    .match-info {text-align:left;}
    .home-team {font-weight:600;color:#fff;margin-bottom:4px;font-size:1rem;}
    .away-team {color:#90a4ae;font-size:0.9rem;}
    
    .odds-cell {text-align:center;}
    .odds-box {
      display:inline-block;
      padding:10px 18px;
      border-radius:8px;
      font-weight:700;
      font-size:1.05rem;
      background:rgba(255,255,255,0.08);
      color:#fff;
      transition:all 0.2s;
      cursor:pointer;
      min-width:60px;
    }
    .odds-box:hover {transform:scale(1.05);background:rgba(255,255,255,0.15);}
    .odds-box.predicted {
      background:linear-gradient(135deg,#ffd700,#ff9800);
      color:#000;
      border:2px solid #ffd700;
      box-shadow:0 0 15px rgba(255,215,0,0.4);
      animation:pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% {box-shadow:0 0 15px rgba(255,215,0,0.4);}
      50% {box-shadow:0 0 25px rgba(255,215,0,0.6);}
    }

    @media (max-width: 1024px) {
      .container {grid-template-columns:1fr;gap:20px;}
      .sidebar {max-height:300px;}
      table {font-size:0.85rem;}
      .odds-box {padding:8px 12px;font-size:0.95rem;min-width:50px;}
      .home-team {font-size:0.9rem;}
      .away-team {font-size:0.8rem;}
    }
  </style>
</head>
<body>
<header class="header">
  <h1>Predicta AI</h1>
  <div class="tagline">Profesyonel Futbol Tahmin Platformu</div>
  <div class="version-badge">v9.0 - √úlke Bazlƒ± Sistem</div>
</header>

<div class="container">
  <aside class="sidebar">
    <div class="sidebar-title">üìã √úlkeler</div>
    <div id="league-list" class="league-list">
      <div class="loading">√úlkeler y√ºkleniyor...</div>
    </div>
  </aside>

  <main>
    <div class="stats-container">
      <div class="stat-box"><div class="stat-value" id="total-matches">0</div><div class="stat-label">Toplam Ma√ß</div></div>
      <div class="stat-box"><div class="stat-value" id="high-confidence">0</div><div class="stat-label">Y√ºksek G√ºven</div></div>
      <div class="stat-box"><div class="stat-value" id="medium-confidence">0</div><div class="stat-label">Orta G√ºven</div></div>
      <div class="stat-box"><div class="stat-value" id="selected-league-name">T√ºm √úlkeler</div><div class="stat-label">Se√ßili B√∂lge</div></div>
    </div>

    <div class="controls">
      <span class="control-label">Filtrele:</span>
      <button class="filter-btn active" onclick="filterMatches('all',event)">T√ºm√º</button>
      <button class="filter-btn" onclick="filterMatches('high-confidence',event)">Y√ºksek G√ºven</button>
      <button class="filter-btn" onclick="filterMatches('medium',event)">Orta G√ºven</button>
      <span class="control-label" style="margin-left:auto;">Sƒ±rala:</span>
      <button class="sort-btn active" onclick="sortMatches('confidence',event)">G√ºvene G√∂re</button>
      <button class="sort-btn" onclick="sortMatches('time',event)">Zamana G√∂re</button>
    </div>

    <div class="main-content">
      <div id="content-area" class="loading">AI tahmin motoru ba≈ülatƒ±lƒ±yor...</div>
    </div>
  </main>
</div>

<script>
  let allMatches = [];
  let currentFilter = 'all';
  let currentSort = 'confidence';
  let selectedLeague = 'all';
  const API_BASE_URL = 'https://predicta-production.up.railway.app';

  const countryTeams = {
    "üáπüá∑ T√ºrkiye": ["Fenerbah√ße", "Galatasaray", "Be≈üikta≈ü", "Trabzonspor", "Ba≈üak≈üehir", "Sivasspor", "Alanyaspor", "Kayserispor", "Gen√ßlerbirliƒüi", "Ankarag√ºc√º", "Konyaspor", "Kasƒ±mpa≈üa", "Hatayspor", "Giresunspor", "√úmraniyespor", "ƒ∞stanbulspor", "Gaziantep", "Adana Demirspor", "Antalyaspor", "Fatih Karag√ºmr√ºk", "Pendikspor", "Samsunspor", "√áaykur Rizespor"],
    "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø ƒ∞ngiltere": ["Bournemouth", "Fulham", "Arsenal", "Chelsea", "Liverpool", "Manchester City", "Manchester United", "Tottenham", "Newcastle", "Brighton", "West Ham", "Crystal Palace", "Wolves", "Aston Villa", "Leeds", "Everton", "Southampton", "Nottingham Forest", "Brentford", "Burnley", "Sheffield United", "Luton Town", "Leicester", "Ipswich"],
    "üáÆüáπ ƒ∞talya": ["Verona", "Sassuolo", "Juventus", "Inter", "Milan", "Napoli", "Roma", "Lazio", "Atalanta", "Fiorentina", "Torino", "Bologna", "Monza", "Udinese", "Empoli", "Salernitana", "Lecce", "Genoa", "Frosinone", "Cagliari", "Parma", "Como", "Venezia"],
    "üá™üá∏ ƒ∞spanya": ["Osasuna", "Getafe", "Real Madrid", "Barcelona", "Atletico Madrid", "Sevilla", "Valencia", "Villarreal", "Real Betis", "Athletic Bilbao", "Real Sociedad", "Celta Vigo", "Mallorca", "Cadiz", "Granada", "Alaves", "Rayo Vallecano", "Las Palmas", "Girona", "Almeria", "Valladolid", "Elche", "Espanyol", "Leganes"],
    "üá©üá™ Almanya": ["Hoffenheim", "Cologne", "Bayern Munich", "Borussia Dortmund", "RB Leipzig", "Bayer Leverkusen", "Borussia M√∂nchengladbach", "Eintracht Frankfurt", "Wolfsburg", "Union Berlin", "Freiburg", "Mainz", "Augsburg", "Stuttgart", "Bochum", "Darmstadt", "Heidenheim", "Werder Bremen", "St. Pauli", "Holstein Kiel"],
    "üá´üá∑ Fransa": ["Paris FC", "Lorient", "Paris Saint-Germain", "Marseille", "Lyon", "Monaco", "Lille", "Nice", "Rennes", "Lens", "Reims", "Nantes", "Montpellier", "Toulouse", "Strasbourg", "Auxerre", "Clermont Foot", "Ajaccio", "Troyes", "Angers", "Brest", "Metz", "Le Havre", "Saint-Etienne"],
    "üá≥üá± Hollanda": ["NAC Breda", "Groningen", "Ajax", "PSV", "Feyenoord", "AZ Alkmaar", "Twente", "Utrecht", "Vitesse", "Heerenveen", "Sparta Rotterdam", "Fortuna Sittard", "Heracles", "PEC Zwolle", "Excelsior", "RKC Waalwijk", "Cambuur", "Go Ahead Eagles", "Volendam", "Almere City", "Willem II"],
    "üáµüáπ Portekiz": ["Casa Pia", "Estoril", "Benfica", "Porto", "Sporting CP", "Braga", "Vitoria Guimaraes", "Boavista", "Famalicao", "Rio Ave", "Santa Clara", "Vizela", "Arouca", "Chaves", "Portimonense", "Maritimo", "Pa√ßos de Ferreira", "Gil Vicente", "Estrela", "Farense"]
  };

  function detectCountryByTeamNames(homeTeam, awayTeam) {
    for (const [country, teams] of Object.entries(countryTeams)) {
      const homeInCountry = teams.some(team => 
        homeTeam.toLowerCase().includes(team.toLowerCase())
      );
      const awayInCountry = teams.some(team => 
        awayTeam.toLowerCase().includes(team.toLowerCase())
      );
      
      if (homeInCountry && awayInCountry) {
        return country;
      } else if (homeInCountry || awayInCountry) {
        return country;
      }
    }
    return "üåç Diƒüer √úlkeler";
  }

  async function loadMatches() {
    try {
      showLoading();
      const response = await fetch(`${API_BASE_URL}/api/predictions/upcoming?limit=500`);
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      const data = await response.json();
      if (data.success && data.matches) {
        allMatches = data.matches.map(match => {
          match.country = detectCountryByTeamNames(match.home_team, match.away_team);
          return match;
        });
        buildCountryList();
        updateStats();
        applyFiltersAndSort();
      }
    } catch (err) {
      showError(err.message);
    }
  }

  function buildCountryList() {
    const countryCounts = {};
    allMatches.forEach(m => {
      const country = m.country || "üåç Diƒüer √úlkeler";
      countryCounts[country] = (countryCounts[country] || 0) + 1;
    });
    
    const priorityCountries = ["üáπüá∑ T√ºrkiye", "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø ƒ∞ngiltere", "üá™üá∏ ƒ∞spanya", "üáÆüáπ ƒ∞talya", "üá©üá™ Almanya", "üá´üá∑ Fransa", "üá≥üá± Hollanda", "üáµüáπ Portekiz"];
    const sortedCountries = Object.keys(countryCounts).sort((a, b) => {
      const aIndex = priorityCountries.indexOf(a);
      const bIndex = priorityCountries.indexOf(b);
      if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
      if (aIndex !== -1) return -1;
      if (bIndex !== -1) return 1;
      return countryCounts[b] - countryCounts[a];
    });
    
    let html = `<div class="league-item ${selectedLeague === 'all' ? 'active' : ''}" onclick="selectLeague('all', event)">
                    üåç <span class="league-name">T√ºm √úlkeler</span>
                    <span class="league-count">${allMatches.length}</span></div>`;
    sortedCountries.forEach(country => {
      html += `<div class="league-item ${selectedLeague === country ? 'active' : ''}" onclick="selectLeague('${country}', event)">
                  <span class="league-name">${country}</span>
                  <span class="league-count">${countryCounts[country]}</span></div>`;
    });
    document.getElementById('league-list').innerHTML = html;
  }

  function selectLeague(l, event) {
    selectedLeague = String(l);
    document.querySelectorAll('.league-item').forEach(x => x.classList.remove('active'));
    event.currentTarget.classList.add('active');
    document.getElementById('selected-league-name').textContent = l === 'all' ? 'T√ºm √úlkeler' : l;
    applyFiltersAndSort();
  }

  function filterMatches(f, event) {
    currentFilter = f;
    document.querySelectorAll('.filter-btn').forEach(x => x.classList.remove('active'));
    event.currentTarget.classList.add('active');
    applyFiltersAndSort();
  }

  function sortMatches(s, event) {
    currentSort = s;
    document.querySelectorAll('.sort-btn').forEach(x => x.classList.remove('active'));
    event.currentTarget.classList.add('active');
    applyFiltersAndSort();
  }

  function normalizeConfidence(c) { return c <= 1 ? c * 100 : c; }

  function applyFiltersAndSort() {
    let filtered = [...allMatches];
    if (selectedLeague !== 'all') filtered = filtered.filter(m => m.country === selectedLeague);
    if (currentFilter === 'high-confidence') filtered = filtered.filter(m => normalizeConfidence(m.ai_prediction?.confidence || 0) >= 65);
    if (currentFilter === 'medium') filtered = filtered.filter(m => { let c = normalizeConfidence(m.ai_prediction?.confidence || 0); return c >= 50 && c < 65; });
    if (currentSort === 'confidence') filtered.sort((a, b) => normalizeConfidence(b.ai_prediction?.confidence || 0) - normalizeConfidence(a.ai_prediction?.confidence || 0));
    if (currentSort === 'time') filtered.sort((a, b) => (`${a.date} ${a.time}`).localeCompare(`${b.date} ${b.time}`));
    updateStats(filtered); 
    displayMatches(filtered);
  }

  function updateStats(f = allMatches) {
    document.getElementById('total-matches').textContent = f.length;
    document.getElementById('high-confidence').textContent = f.filter(m => normalizeConfidence(m.ai_prediction?.confidence || 0) >= 65).length;
    document.getElementById('medium-confidence').textContent = f.filter(m => { let c = normalizeConfidence(m.ai_prediction?.confidence || 0); return c >= 50 && c < 65; }).length;
  }

  function displayMatches(matches) {
    const area = document.getElementById('content-area');
    if (matches.length === 0) { 
      area.innerHTML = `<div class="loading">Bu √ºlke/filtre i√ßin ma√ß bulunamadƒ±</div>`; 
      return; 
    }

    const grouped = {};
    matches.forEach(m => {
      const country = m.country || "üåç Diƒüer √úlkeler";
      if (!grouped[country]) grouped[country] = [];
      grouped[country].push(m);
    });

    const priorityCountries = ["üáπüá∑ T√ºrkiye", "üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø ƒ∞ngiltere", "üá™üá∏ ƒ∞spanya", "üáÆüáπ ƒ∞talya", "üá©üá™ Almanya", "üá´üá∑ Fransa", "üá≥üá± Hollanda", "üáµüáπ Portekiz"];
    const sortedCountries = Object.keys(grouped).sort((a, b) => {
      const aIndex = priorityCountries.indexOf(a);
      const bIndex = priorityCountries.indexOf(b);
      if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
      if (aIndex !== -1) return -1;
      if (bIndex !== -1) return 1;
      return a.localeCompare(b);
    });

    let html = '';
    sortedCountries.forEach(country => {
      const maclar = grouped[country];
      
      html += `<div class="league-section">
                <div class="league-header">
                  <div class="league-title">${country}</div>
                  <div class="league-match-count">${maclar.length} ma√ß</div>
                </div>
                <div class="match-table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>Tarih/Saat</th>
                        <th>Ma√ß</th>
                        <th>1</th>
                        <th>X</th>
                        <th>2</th>
                      </tr>
                    </thead>
                    <tbody>`;
      
      maclar.forEach(m => {
        const p = m.ai_prediction || {};
        const result = p.predicted_result || p.result || 'X';
        const odds1 = m.odds?.['1'] || 2.0;
        const oddsX = m.odds?.X || 3.0;
        const odds2 = m.odds?.['2'] || 3.5;
        
        html += `<tr>
                   <td class="match-time">
                     ${m.date.split('-')[2]}/${m.date.split('-')[1]}<br>${m.time}
                   </td>
                   <td class="match-info">
                     <div class="home-team">${m.home_team}</div>
                     <div class="away-team">${m.away_team}</div>
                   </td>
                   <td class="odds-cell">
                     <div class="odds-box ${result === '1' ? 'predicted' : ''}">${odds1.toFixed(2)}</div>
                   </td>
                   <td class="odds-cell">
                     <div class="odds-box ${result === 'X' ? 'predicted' : ''}">${oddsX.toFixed(2)}</div>
                   </td>
                   <td class="odds-cell">
                     <div class="odds-box ${result === '2' ? 'predicted' : ''}">${odds2.toFixed(2)}</div>
                   </td>
                 </tr>`;
      });
      
      html += `</tbody></table></div></div>`;
    });

    area.innerHTML = html;
  }

  function showLoading() { document.getElementById('content-area').innerHTML = '<div class="loading">Veriler y√ºkleniyor...</div>'; }
  function showError(m) { document.getElementById('content-area').innerHTML = `<div style="color:red">Hata: ${m}</div>`; }
  
  window.addEventListener('load', () => { 
    loadMatches(); 
    setInterval(loadMatches, 300000);
  });
</script>
</body>
</html>